{% extends "site_base.html" %}
{% load i18n %}

{% block head_title %}{{ song.name }}{% endblock %}

{% block extra_style %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}mediaelementjs/mediaelementplayer.min.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}repertory/css/style.css" />
{% endblock %}

{% block extra_script %}
{{ block.super }}
    <script src="{{ STATIC_URL }}mediaelementjs/mediaelement-and-player.min.js"></script>
    <script>
        $('audio').mediaelementplayer({audioWidth: 220, audioHeight: 30,
            features: ['playpause','progress','current','tracks', 'fullscreen'],});
        $('a').popover({trigger: "hover", placement: "right", delay: {show: 300, hide: 0}});
    </script>
    {% if show_score %}
        <script src="{{ STATIC_URL }}pdfjs/pdf.js"></script>
        <script type="text/javascript">
            PDFJS.workerSrc = '{{ STATIC_URL }}pdfjs/pdf.js';
            var pdfWithFormsPath = '{{ song.get_score.get_absolute_url }}';
        </script>
        <script src="{{ STATIC_URL }}repertory/js/pdf-viewer.js"></script>
    {% endif %}
    {% if show_chords %}
        <script src="{{ STATIC_URL }}pdfjs/pdf.js"></script>
        <script type="text/javascript">
            PDFJS.workerSrc = '{{ STATIC_URL }}pdfjs/pdf.js';
            var pdfWithFormsPath = '{{ song.get_chords_url }}';
        </script>
        <script src="{{ STATIC_URL }}repertory/js/pdf-viewer.js"></script>
    {% endif %}
{% endblock %}

{% block body %}

<div class="page-header">
    <h2>
        {% if perms.repertory.change_song %}
            <a href="{% url admin:repertory_song_change song.pk %}" rel="tooltip" title="Modifica"><i class="icon-edit icon-black"></i></a>
        {% endif %}
        {% if perms.recording.change_recordingsong %}
            {% if song.recordingsong %}
                {{ song.recordingsong.get_link }}
            {% endif %}
        {% endif %}
        {{ song.name }}
    </h2>
</div>

<div class="row-fluid">
    {% if perms.repertory %}
    <div class="span3">
        {% for type in song.get_type_files %}
            <div class="songfile">
                <!-- Title -->
                <div class="row-fluid"> <h4>{{ type.description }}</h4> </div>
                {% for file in type.files %}
                    <div class="row-fluid">
                        {% ifequal file.get_extension 'mp3' %}
                            <div class="span1"> {{ file.get_link }} </div>
                            <div class="span11">
                                <audio src="{{ file.get_absolute_url }}" type="audio/mp3" controls="controls" preload="none"></audio>
                            </div>
                        {% else %}
                            <div class="span12"> {{ file.get_link }} </div>
                        {% endifequal %}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
    <div class="span9">
    {% else %}
    <div class="span12">
    {% endif %}
        <div class="row-fluid">
            {% if song.get_detail or song.score_number %}
                <h4>
                    {{ song.get_detail }}
                    {% if song.score_number and perms.repertory %}
                        {% if song.get_detail %} - {% endif %}{% trans "Score" %}: {{ song.score_number}}
                    {% endif %}
                </h4>
            {% endif %}
        </div>
        {% if show_score or show_chords %}
            <div class="row">
                <div id="pdf-viewer"></div>
            </div>
        {% endif %}
    </div>

</div>

{% endblock %}
